@page "/"
@using RaftLibrary
@rendermode InteractiveServer

<PageTitle>Home</PageTitle>

<button @onclick="StartSim">start</button>

<div class="row">
    @foreach (var node in nodes)
    {
        <div class="p-3 col-4">
            @node.Id
            <div>
                @node.InnerNode.State
            </div>aria-valuenow=@(Math.Abs(timeout))

        </div>
    }
</div>


@code {
    List<SimNode> nodes = [];
    private Timer? timer;
    void StartSim()
    {
        var node1 = new Node([], 1); //consider initializing with other nodes and the own node id Node([], 1)
        var node2 = new Node([], 2); //consider initializing with other nodes and the own node id
        var node3 = new Node([], 3); //consider initializing with other nodes and the own node id

        var simulation1 = new SimNode(node1);
        var simulation2 = new SimNode(node2);
        var simulation3 = new SimNode(node3);

        node1.OtherNodes = [simulation2, simulation3];
        node2.OtherNodes = [simulation1, simulation3];
        node3.OtherNodes = [simulation1, simulation2];

        nodes = [simulation1, simulation2, simulation3];
        StateHasChanged();

        node1.StartElection();
        node2.StartElection();
        node3.StartElection();
        timer = new Timer(_ =>
        {
            Console.WriteLine("here");
            InvokeAsync(StateHasChanged);
        }, null, 0, 200);


    }
}
